(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='WolframDesktop 14.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       161,          7]
NotebookDataLength[     17010,        397]
NotebookOptionsPosition[     16396,        378]
NotebookOutlinePosition[     16831,        395]
CellTagsIndexPosition[     16788,        392]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Calculates", " ", "raycast", " ", "from", " ", "an", " ", "arbitrary", 
    " ", "starting", " ", "point", " ", "and", " ", "angle", " ", "in", " ", 
    "a", " ", "polygon"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"castRayPolygon", "[", 
      RowBox[{"poly_", ",", " ", "point_", ",", "originVector_"}], "]"}], " ",
      ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "currentSide", ",", "ray", ",", "sides", ",", "collisions", ",", 
         "pointOfCollision", ",", "oppRay", ",", "newDirection"}], "}"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sides", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Line", " ", "/@", " ", 
              RowBox[{"Partition", "[", 
               RowBox[{"#", ",", "2", ",", "1"}], "]"}]}], "&"}], " ", "@", 
            " ", 
            RowBox[{"Partition", "[", 
             RowBox[{"#", ",", "2"}], "]"}]}], "&"}], " ", "@", " ", 
          RowBox[{"(", 
           RowBox[{"Flatten", " ", "@", " ", 
            RowBox[{"(", 
             RowBox[{"List", " ", "@@", " ", 
              RowBox[{"RegionBoundary", "[", "poly", "]"}]}], ")"}]}], 
           ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"currentSide", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Extract", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", "1", "}"}]}], "]"}], "&"}], " ", "@", " ", 
          RowBox[{"First", " ", "@", " ", 
           RowBox[{
            RowBox[{"SortBy", "[", 
             RowBox[{
              RowBox[{"RegionDistance", "[", 
               RowBox[{"#", ",", "point"}], "]"}], "&"}], "]"}], " ", "@", 
            " ", "sides"}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"newDirection", " ", "=", " ", 
         RowBox[{"calculateNewDirection", "[", 
          RowBox[{"originVector", ",", 
           RowBox[{
            RowBox[{"collisionSide", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "-", 
            RowBox[{"collisionSide", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ray", " ", "=", " ", 
         RowBox[{"HalfLine", "[", 
          RowBox[{"point", ",", "newDirection"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"collisions", " ", "=", " ", 
         RowBox[{"FindInstance", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"x", ",", "y"}], "}"}], "\[Element]", "ray"}], " ", "&&",
             " ", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"x", ",", "y"}], "}"}], " ", "\[Element]", " ", 
             RowBox[{"RegionBoundary", "[", "poly", "]"}]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "y"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pointOfCollision", " ", "=", " ", 
         RowBox[{"Flatten", " ", "@", " ", 
          RowBox[{"First", " ", "@", " ", 
           RowBox[{
            RowBox[{"SortBy", "[", 
             RowBox[{
              RowBox[{"EuclideanDistance", "[", 
               RowBox[{
                RowBox[{"RegionCentroid", "@", "poly"}], ",", "#"}], "]"}], 
              "&"}], "]"}], " ", "@", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"x", ",", "y"}], "}"}], " ", "/.", "  ", 
              "collisions"}], ")"}]}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", " ", "@", " ", 
         RowBox[{"{", 
          RowBox[{
          "pointOfCollision", ",", " ", "currentSide", ",", "point", ",", 
           "newDirection"}], "}"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"calculateNewDirection", "[", 
      RowBox[{"originVector_", ",", " ", "sideVec_"}], "]"}], ":=", " ", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"2", "*", 
        RowBox[{"Projection", "[", 
         RowBox[{"originVector", ",", "sideVec"}], "]"}]}], "-", 
       "originVector"}], "\[IndentingNewLine]", ")"}]}], ";"}], "\n", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fullRayCast", "[", 
      RowBox[{"poly_", ",", " ", "phi_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"init", ",", " ", "rayCastInfo", ",", "reflectInfo"}], "}"}], 
       ",", "\n", "\t", 
       RowBox[{
        RowBox[{"init", " ", "=", " ", 
         RowBox[{"RandomPoint", " ", "@", " ", 
          RowBox[{"RegionBoundary", " ", "@", " ", "poly"}]}]}], ";", "\n", 
        "\t", 
        RowBox[{"sides", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Line", " ", "/@", " ", 
              RowBox[{"Partition", "[", 
               RowBox[{"#", ",", "2", ",", "1"}], "]"}]}], "&"}], " ", "@", 
            " ", 
            RowBox[{"Partition", "[", 
             RowBox[{"#", ",", "2"}], "]"}]}], "&"}], " ", "@", " ", 
          RowBox[{"(", 
           RowBox[{"Flatten", " ", "@", " ", 
            RowBox[{"(", 
             RowBox[{"List", " ", "@@", " ", 
              RowBox[{"RegionBoundary", "[", "poly", "]"}]}], ")"}]}], 
           ")"}]}]}], ";", "\n", "\t", 
        RowBox[{"rayCastInfo", " ", "=", " ", 
         RowBox[{"castRayPolygon", "[", 
          RowBox[{"poly", ",", "init", ",", "phi"}], "]"}]}], ";"}]}], "\n", 
      "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.9291058630352726`*^9, 3.929105863756462*^9}, {
   3.929107085744961*^9, 3.929107131894436*^9}, {3.929107167861328*^9, 
   3.9291072158011875`*^9}, {3.929107251046774*^9, 3.92910725327285*^9}, {
   3.929107286526327*^9, 3.929107319670336*^9}, {3.9291076399985657`*^9, 
   3.929107647218275*^9}, {3.9291077464985104`*^9, 3.9291077633043213`*^9}, {
   3.9291078097302494`*^9, 3.929107809934561*^9}, {3.929107894560507*^9, 
   3.929107895841379*^9}, {3.9291079463684673`*^9, 3.9291079910780582`*^9}, {
   3.929108021538986*^9, 3.9291080219678574`*^9}, {3.9291083977773876`*^9, 
   3.929108427375492*^9}, {3.929108670519642*^9, 3.92910869130966*^9}, {
   3.929108724514683*^9, 3.929108872626642*^9}, {3.92910890318314*^9, 
   3.9291089267029495`*^9}, {3.9291090145981255`*^9, 
   3.9291090449679604`*^9}, {3.929109114693651*^9, 3.929109116735628*^9}, {
   3.9291091801109943`*^9, 3.929109181299124*^9}, {3.9291092211551*^9, 
   3.9291092865530415`*^9}, {3.9291093410947704`*^9, 3.929109349050207*^9}, {
   3.929109489577902*^9, 3.9291094928101406`*^9}, {3.9291095557713966`*^9, 
   3.9291095560421524`*^9}, {3.929110548701313*^9, 3.9291105804299736`*^9}, {
   3.929110642640831*^9, 3.929110668347231*^9}, {3.929110715103197*^9, 
   3.9291107292197227`*^9}, {3.9291108528978424`*^9, 
   3.9291108530940666`*^9}, {3.9291109050531654`*^9, 
   3.9291109064194393`*^9}, {3.9291112379024715`*^9, 3.929111251735895*^9}, {
   3.929111329472231*^9, 3.9291113302740307`*^9}, {3.9291113681194706`*^9, 
   3.929111370474949*^9}, {3.9291114749422035`*^9, 3.929111477885187*^9}, {
   3.9291115105023594`*^9, 3.9291115159145584`*^9}, {3.9291121134280834`*^9, 
   3.9291121293800335`*^9}, {3.929112230620756*^9, 3.9291122836671696`*^9}, {
   3.9291123849726067`*^9, 3.929112393924732*^9}, {3.9291124341977806`*^9, 
   3.9291124635146713`*^9}, {3.9291125017706623`*^9, 3.929112633297182*^9}, {
   3.929112714177992*^9, 3.929112715409086*^9}, {3.9291128070749264`*^9, 
   3.929112809424656*^9}, {3.929112942786106*^9, 3.9291129516077023`*^9}, {
   3.9291130286586456`*^9, 3.929113104764082*^9}, {3.929113135473997*^9, 
   3.929113139727398*^9}, {3.929113191024065*^9, 3.929113192188101*^9}, {
   3.929113311548044*^9, 3.9291133238082085`*^9}, {3.929113776832468*^9, 
   3.9291138982162*^9}, {3.929113938807232*^9, 3.9291139404831448`*^9}, {
   3.9291139878382874`*^9, 3.9291139880550327`*^9}, {3.9291147856806297`*^9, 
   3.929114823885561*^9}, {3.9291148731420956`*^9, 3.929114878311928*^9}, {
   3.9291278228318615`*^9, 3.9291278248195877`*^9}, {3.929127878976364*^9, 
   3.9291279473301525`*^9}, {3.929128062100231*^9, 3.929128089988323*^9}, {
   3.929128277141428*^9, 3.92912828116103*^9}, {3.9291284242356434`*^9, 
   3.9291284347374783`*^9}, {3.9291284669552536`*^9, 3.929128483004957*^9}, {
   3.9291286473516464`*^9, 3.929128663632475*^9}, {3.9291288482409096`*^9, 
   3.929128890964033*^9}, {3.929129282199913*^9, 3.929129294544964*^9}, {
   3.929129330579735*^9, 3.9291293342705517`*^9}, {3.9291293694341354`*^9, 
   3.929129372374197*^9}, {3.9291300956708984`*^9, 3.9291301219994507`*^9}, {
   3.929130181848467*^9, 3.929130183451378*^9}, {3.929130512671669*^9, 
   3.929130531265236*^9}, {3.929130573401676*^9, 3.929130581385544*^9}, {
   3.9291328529426136`*^9, 3.929132855615484*^9}, 3.92913291161932*^9},
 CellLabel->
  "In[137]:=",ExpressionUUID->"640ddbe4-cb9f-4047-9d78-78d8094573d6"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"n", " ", "=", " ", 
   RowBox[{"RandomInteger", "[", 
    RowBox[{"{", 
     RowBox[{"3", ",", "6"}], "}"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"poly", " ", "=", " ", 
   RowBox[{"RandomPolygon", "[", "n", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"boundary", " ", "=", " ", 
   RowBox[{"RegionBoundary", "[", "poly", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"sides", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Line", " ", "/@", " ", 
        RowBox[{"Partition", "[", 
         RowBox[{"#", ",", "2", ",", "1"}], "]"}]}], "&"}], " ", "@", " ", 
      RowBox[{"Partition", "[", 
       RowBox[{"#", ",", "2"}], "]"}]}], "&"}], " ", "@", " ", 
    RowBox[{"(", 
     RowBox[{"Flatten", " ", "@", " ", 
      RowBox[{"(", 
       RowBox[{"List", " ", "@@", " ", "boundary"}], ")"}]}], ")"}]}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"centroid", " ", "=", " ", 
   RowBox[{"RegionCentroid", "[", "poly", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ray", " ", "=", " ", 
   RowBox[{"HalfLine", "[", 
    RowBox[{"centroid", ",", 
     RowBox[{"5", "*", 
      RowBox[{"AngleVector", "[", 
       RowBox[{"RandomReal", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"2", "*", "Pi"}]}], "}"}], "]"}], "]"}]}]}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"points", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Flatten", " ", "@", " ", 
      RowBox[{"FindInstance", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"x", ",", "y"}], "}"}], "\[Element]", "ray"}], " ", "&&", 
         " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"x", ",", "y"}], "}"}], " ", "\[Element]", " ", "#"}]}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "y"}], "}"}]}], "]"}]}], "&"}], " ", "/@", "  ", 
    "sides"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"breakPoint", " ", "=", " ", 
   RowBox[{"Flatten", " ", "@", " ", 
    RowBox[{"First", " ", "@", " ", 
     RowBox[{
      RowBox[{"SortBy", "[", 
       RowBox[{
        RowBox[{"EuclideanDistance", "[", 
         RowBox[{"centroid", ",", "#"}], "]"}], "&"}], "]"}], " ", "@", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"x", ",", "y"}], "}"}], " ", "/.", " ", 
          RowBox[{"DeleteElements", "[", 
           RowBox[{"#", ",", 
            RowBox[{"{", 
             RowBox[{"{", "}"}], "}"}]}], "]"}]}], "&"}], " ", "@", " ", 
        "points"}], ")"}]}]}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"collisionSide", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Extract", "[", 
      RowBox[{"#", ",", 
       RowBox[{"{", "1", "}"}]}], "]"}], "&"}], " ", "@", " ", 
    RowBox[{"First", " ", "@", " ", 
     RowBox[{"SortBy", "[", 
      RowBox[{"sides", ",", " ", 
       RowBox[{
        RowBox[{"RegionDistance", "[", 
         RowBox[{"#", ",", "breakPoint"}], "]"}], "&"}]}], "]"}]}]}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"castInfo", " ", "=", " ", 
   RowBox[{"castRayPolygon", "[", 
    RowBox[{"poly", ",", " ", "breakPoint", ",", " ", 
     RowBox[{"breakPoint", "-", "centroid"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Graphics", "[", 
  RowBox[{"{", 
   RowBox[{"boundary", ",", " ", "Red", ",", " ", 
    RowBox[{"Point", "[", "centroid", "]"}], ",", "Blue", ",", 
    RowBox[{"Point", "[", "breakPoint", "]"}], ",", "LightRed", ",", 
    RowBox[{"Line", "[", 
     RowBox[{"{", 
      RowBox[{"breakPoint", ",", "centroid"}], "}"}], "]"}], ",", 
    RowBox[{"HalfLine", "[", 
     RowBox[{"breakPoint", ",", " ", 
      RowBox[{"castInfo", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], "]"}]}], "}"}], "]"}]}], "Input",
 CellChangeTimes->{{3.929105875983856*^9, 3.9291058873708115`*^9}, {
   3.929106333964365*^9, 3.929106417713798*^9}, {3.929106452526177*^9, 
   3.9291064587893295`*^9}, {3.9291065409135017`*^9, 3.929106601488096*^9}, {
   3.929106648307898*^9, 3.929106650408924*^9}, {3.929106700122227*^9, 
   3.92910672678133*^9}, {3.9291067852235756`*^9, 3.929107035072243*^9}, {
   3.929107226888256*^9, 3.929107235286957*^9}, {3.929107862637991*^9, 
   3.9291078630595*^9}, {3.9291079382238407`*^9, 3.9291079387594204`*^9}, {
   3.929108082875326*^9, 3.9291082215145626`*^9}, {3.929108490075575*^9, 
   3.929108572587557*^9}, {3.9291086099151344`*^9, 3.9291086122662506`*^9}, 
   3.9291090890863495`*^9, 3.9291127203290844`*^9, {3.9291302206657333`*^9, 
   3.9291302596275425`*^9}, {3.929130492803213*^9, 3.929130495316492*^9}, {
   3.929130541914896*^9, 3.929130548528614*^9}, {3.92913060245879*^9, 
   3.9291306029612465`*^9}, {3.929131852865305*^9, 3.9291318960144634`*^9}, {
   3.9291325789375896`*^9, 3.9291325972508755`*^9}, 3.9291327110838814`*^9, {
   3.9291327771518745`*^9, 3.9291327800100937`*^9}, {3.9291328679866276`*^9, 
   3.9291328945274715`*^9}, {3.9291329750211105`*^9, 3.929133052415497*^9}, {
   3.9291330955044518`*^9, 3.929133135577257*^9}, {3.929133186338032*^9, 
   3.929133355100504*^9}, {3.9291333977282104`*^9, 3.929133398689722*^9}},
 CellLabel->
  "In[375]:=",ExpressionUUID->"0ce454a8-0b94-e246-9ecb-e37d80c8e134"],

Cell[BoxData[
 GraphicsBox[{
   LineBox[{{0.014110898353053791`, 0.0949606000257468}, {0.2787193617308372, 
    0.06348820875707517}, {0.8020002983108094, 0.015062476782445433`}, {
    0.7010631938356047, 0.3532675222417574}, {0.8035190926388849, 
    0.4724036038582782}, {0.5635891822819905, 0.9652980440890031}, {
    0.014110898353053791`, 0.0949606000257468}}], 
   {RGBColor[1, 0, 0], PointBox[{0.4778437000572304, 0.37907915623528043`}]}, 
   {RGBColor[0, 0, 1], 
    PointBox[{0.42070010063219754`, 0.050348954626141654`}]}, 
   {RGBColor[1, 0.85, 0.85], 
    LineBox[{{0.42070010063219754`, 0.050348954626141654`}, {
     0.4778437000572304, 0.37907915623528043`}}], 
    TagBox[
     ConicHullRegionBox[{{0.42070010063219754`, 0.050348954626141654`}}, {{
      0.004153252849950634, 0.3336340613546495}}],
     "HalfLine"]}}]], "Output",
 CellChangeTimes->{{3.929131865362627*^9, 3.929131896764675*^9}, {
   3.929132583154972*^9, 3.9291325978623047`*^9}, {3.929132896265972*^9, 
   3.9291329224964504`*^9}, {3.929132982548233*^9, 3.92913299072365*^9}, {
   3.9291330211265335`*^9, 3.92913305301919*^9}, {3.929133122833128*^9, 
   3.92913313675198*^9}, {3.9291331965747795`*^9, 3.9291332499865513`*^9}, 
   3.929133305624222*^9, {3.9291333999312134`*^9, 3.929133410154051*^9}, {
   3.9291345843019905`*^9, 3.929134598583578*^9}},
 CellLabel->
  "Out[385]=",ExpressionUUID->"ab663646-9f9a-9a48-bb13-610b4272fbb9"]
}, Open  ]]
},
WindowSize->{1141.2, 573.6},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
Magnification:>1.1 Inherited,
FrontEndVersion->"14.0 for Microsoft Windows (64-bit) (December 16, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"f4f5b2a1-c488-e845-bdfd-32a081cb1ef9"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[561, 20, 9143, 192, 450, "Input",ExpressionUUID->"640ddbe4-cb9f-4047-9d78-78d8094573d6"],
Cell[CellGroupData[{
Cell[9729, 216, 5227, 132, 262, "Input",ExpressionUUID->"0ce454a8-0b94-e246-9ecb-e37d80c8e134"],
Cell[14959, 350, 1421, 25, 493, "Output",ExpressionUUID->"ab663646-9f9a-9a48-bb13-610b4272fbb9"]
}, Open  ]]
}
]
*)

